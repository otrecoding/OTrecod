<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>indiv_grp_optimal() — indiv_grp_optimal • OTrecod</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="indiv_grp_optimal() — indiv_grp_optimal" />
<meta property="og:description" content="This function assigns individual predictions to the incomplete information of two integrated datasources by solving a linear optimization problem." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



<!-- dependencies from examples -->


  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">OTrecod</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/an-application-of-the-OTrecod-package.html">an-application-of-the-OTrecod-package</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>indiv_grp_optimal()</h1>
    
    <div class="hidden name"><code>indiv_grp_optimal.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function assigns individual predictions to the incomplete information of two integrated datasources by solving a linear optimization problem.</p>
    </div>

    <pre class="usage"><span class='fu'>indiv_grp_optimal</span><span class='op'>(</span>
  <span class='va'>proxim</span>,
  <span class='va'>jointprobaA</span>,
  <span class='va'>jointprobaB</span>,
  percent_closest <span class='op'>=</span> <span class='fl'>1</span>,
  solvr <span class='op'>=</span> <span class='st'>"glpk"</span>,
  which.DB <span class='op'>=</span> <span class='st'>"BOTH"</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>proxim</th>
      <td><p>a <code><a href='proxim_dist.html'>proxim_dist</a></code> object or an object of similar structure</p></td>
    </tr>
    <tr>
      <th>jointprobaA</th>
      <td><p>a matrix whose number of columns is equal to the number of modalities of the target variable \(Y\) in database A, and whose number of rows is equal to the number of modalities of \(Z\) in database B. It gives an estimation of the joint probability \((Y,Z)\) in the database A.
The sum of cells of this matrix must be equal to 1.</p></td>
    </tr>
    <tr>
      <th>jointprobaB</th>
      <td><p>a matrix whose number of columns is equal to the number of modalities of the target variable Y in database A, and whose number of rows is equal to the number of modalities of \(Z\) in database B. It gives an estimation of the joint probability \((Y,Z)\) in the database B.
The sum of cells of this matrix must be equal to 1.</p></td>
    </tr>
    <tr>
      <th>percent_closest</th>
      <td><p>a value between 0 and 1 (by default) corresponding to the fixed <code>percent closest</code> of individuals used in the computation of the average distances</p></td>
    </tr>
    <tr>
      <th>solvr</th>
      <td><p>a character string that specifies the type of method selected to solve the optimization algorithms. The default solver is "glpk".</p></td>
    </tr>
    <tr>
      <th>which.DB</th>
      <td><p>a character string that indicates which individual predictions are computed: only the individual predictions of \(Y\) in B ("B"), only those of \(Z\) in A ("A") or the both ("BOTH" by default).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of two vectors of numeric values:</p>
<dt>YAtrans</dt><dd><p>a vector corresponding to the predicted values of \(Y\) in database B (numeric form) according to the <code>which.DB</code> argument</p></dd>
<dt>ZBtrans</dt><dd><p>a vector corresponding to the predicted values of \(Z\) in database A (numeric form) according to the <code>which.DB</code> argument</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>A. THE RECODING PROBLEM IN DATA FUSION</p>
<p>Assuming that \(Y\) and \(Z\) are two target variables which refered to the same target population in two separate databases A and B respectively (no overlapping rows),
so that \(Y\) and \(Z\) are never jointly observed. Assuming also that A and B share a subset of common covariates \(X\) of any types (same encodings in A and B)
completed or not. Merging these two databases often requires to solve a recoding problem by creating an unique database where
the missing information of \(Y\) and \(Z\) is fully completed.</p>

<p>B. DESCRIPTION OF THE FUNCTION</p>
<p>The function <code>indiv_grp_optimal</code> is an intermediate function used in the implementation of an algorithm called <code>OUTCOME</code> (and its enrichment <code>R-OUTCOME</code> (2)) dedicated to the solving of recoding problems in data fusion using Optimal Transportation theory.
The model is implemented in the function <code><a href='OT_outcome.html'>OT_outcome</a></code> which integrates the function <code>indiv_grp_optimal</code> in its syntax as a possible second step of the algorithm.
The function <code>indiv_grp_optimal</code> can nevertheless be used separately providing that the argument <code>proxim</code> receives an output object of the function <code><a href='proxim_dist.html'>proxim_dist</a></code>.
This latter is available in the package and is so directly usable beforehand.</p>
<p>The function <code>indiv_grp_optimal</code> constitutes an alternative method to the nearest neighbor procedure implemented in the function <code><a href='indiv_grp_closest.html'>indiv_grp_closest</a></code>.
As for the function <code><a href='indiv_grp_closest.html'>indiv_grp_closest</a></code>, assuming that the objective consists in the prediction of \(Z\) in the database A, the first step of the algorithm related to <code>OUTCOME</code> provides an estimate of \(\gamma\), the solution of the optimization problem, which can be seen, in this case as an estimation of the joint distribution \((Y,Z)\) in A.
Rather than using a nearest neighbor approach to provide individual predictions, the function <code>indiv_grp_optimal</code> solves an optimization problem using the simplex algorithm which searches for the individual predictions of \(Z\) that minimize the computed total distance satisfying the joint probability distribution estimated in the first part.
More details about the theory related to the solving of this optimization problem is described in the section 5.3 of (2).</p>
<p>Obviously, this algorithm  runs in the same way for the prediction of \(Y\) in the database B.
The function <code>indiv_grp_optimal</code> integrates in its syntax the function <code><a href='avg_dist_closest.html'>avg_dist_closest</a></code> and the related argument <code>percent_closest</code> is identical in the two functions.
Thus, when computing average distances between an individual i and a subset of individuals assigned to a same level of \(Y\) or \(Z\) is required, user can decide if all individuals from the subset of interest can participate to the computation (<code>percent_closest = 1</code>) or only a fixed part p (&lt;1) corresponding to the closest neighbors of i (in this case <code>percent_closest</code> = p).</p>
<p>The arguments <code>jointprobaA</code> and <code>jointprobaB</code> can be seen as estimations of \(\gamma\) (sum of cells must be equal to 1) that correspond to estimations of the joint distributions of \((Y,Z)\) in A and B respectively.</p>
<p>The argument <code>solvr</code> permits user to choose the solver of the optimization algorithm. The default solver is "glpk" that corresponds to the GNU Linear Programming Kit (see (3) for more details). The solver "clp" (see (4)) for Coin-or Linear Programming, convenient in linear and quadratic situations, is also directly integrated in the function.
Moreover, the function actually uses the <code>R</code> optimization infrastructure of the package <span class="pkg">ROI</span> which offers a wide choice of solver to users by easily loading the associated plugins of <span class="pkg">ROI</span> (see (5)).</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ol>
<li><p>Gares V, Dimeglio C, Guernec G, Fantin F, Lepage B, Korosok MR, savy N (2019). On the use of optimal transportation theory to recode variables and application to database merging. The International Journal of Biostatistics.
Volume 16, Issue 1, 20180106, eISSN 1557-4679. doi:10.1515/ijb-2018-0106</p></li>
<li><p>Gares V, Omer J (2020) Regularized optimal transport of covariates and outcomes in data recoding. Journal of the American Statistical Association. doi: <a href='https://doi.org/10.1080/01621459.2020.1775615'>10.1080/01621459.2020.1775615</a></p></li>
<li><p>Makhorin A (2011). GNU Linear Programming Kit Reference Manual Version 4.47.<a href='http://www.gnu.org/software/glpk/'>http://www.gnu.org/software/glpk/</a></p></li>
<li><p>Forrest J, de la Nuez D, Lougee-Heimer R (2004). Clp User Guide. <a href='https://www.coin-or.org/Clp/userguide/index.html'>https://www.coin-or.org/Clp/userguide/index.html</a></p></li>
<li><p>Theussl S, Schwendinger F, Hornik K (2020). ROI: An Extensible R Optimization Infrastructure.Journal of Statistical Software,94(15), 1-64. doi: <a href='https://doi.org/10.18637/jss.v094.i15'>10.18637/jss.v094.i15</a></p></li>
</ol>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='proxim_dist.html'>proxim_dist</a></code>, <code><a href='avg_dist_closest.html'>avg_dist_closest</a></code>, <code><a href='indiv_grp_closest.html'>indiv_grp_closest</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Gregory Guernec, Valerie Gares, Jeremy Omer</p>
<p><a href='mailto:otrecod.pkg@gmail.com'>otrecod.pkg@gmail.com</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>### Example using The Euclidean distance on a complete database</span>
<span class='co'># For this example we keep only 200 rows:</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>tab_test</span><span class='op'>)</span>
<span class='va'>tab_test2</span> <span class='op'>=</span> <span class='va'>tab_test</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>80</span>,<span class='fl'>5001</span><span class='op'>:</span><span class='fl'>5080</span><span class='op'>)</span>,<span class='op'>]</span>; <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>tab_test2</span><span class='op'>)</span>
</div><div class='co'>#&gt; [1] 160   6</div><div class='input'>
<span class='co'># Adding NAs in Y1 and Y2</span>
<span class='va'>tab_test2</span><span class='op'>[</span><span class='va'>tab_test2</span><span class='op'>$</span><span class='va'>ident</span> <span class='op'>==</span> <span class='fl'>2</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>=</span> <span class='cn'>NA</span>
<span class='va'>tab_test2</span><span class='op'>[</span><span class='va'>tab_test2</span><span class='op'>$</span><span class='va'>ident</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='fl'>3</span><span class='op'>]</span> <span class='op'>=</span> <span class='cn'>NA</span>

<span class='co'># Because all covariates are ordered in numeric form,</span>
<span class='co'># the transfo_dist function is not required here</span>

<span class='va'>res3</span>      <span class='op'>=</span> <span class='fu'><a href='proxim_dist.html'>proxim_dist</a></span><span class='op'>(</span><span class='va'>tab_test2</span>,norm <span class='op'>=</span> <span class='st'>"M"</span><span class='op'>)</span>

<span class='co'>#' ### Y(Y1) and Z(Y2) are a same variable encoded in 2 different forms:</span>
<span class='co'>### 4 levels for Y1 and 3 levels for Y2</span>
<span class='co'>### ... Stored in two distinct databases, A and B, respectively</span>
<span class='co'>### The marginal distribution of Y in B is unknown,</span>
<span class='co'>### as the marginal distribution of Z in A ...</span>

<span class='co'># Assuming that the following matrix called transport symbolizes</span>
<span class='co'># an estimation of the joint distribution L(Y,Z) ...</span>
<span class='co'># Note that, in reality this distribution is UNKNOWN and is</span>
<span class='co'># estimated in the OT function by resolving the optimization problem.</span>

<span class='co'># By supposing:</span>

<span class='va'>val_trans</span>  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.275</span>,<span class='fl'>0.115</span>,<span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0.085</span>,<span class='fl'>0.165</span>,<span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0.095</span>,<span class='fl'>0.265</span><span class='op'>)</span>
<span class='va'>transport2</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>val_trans</span>,ncol <span class='op'>=</span> <span class='fl'>3</span>,byrow <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># Getting the individual predictions of Z in A (only)</span>
<span class='co'># by computing average distances on 90% of the nearest neighbors of</span>
<span class='co'># each modality of Z in B</span>
<span class='va'>res4</span>      <span class='op'>=</span> <span class='fu'>indiv_grp_optimal</span><span class='op'>(</span><span class='va'>res3</span>,jointprobaA <span class='op'>=</span> <span class='va'>transport2</span>,
            jointprobaB <span class='op'>=</span> <span class='va'>transport2</span>, percent_closest<span class='op'>=</span> <span class='fl'>0.90</span>,
            which.DB <span class='op'>=</span> <span class='st'>"A"</span><span class='op'>)</span>

<span class='co'># \donttest{</span>
<span class='co'>### Example 2 using The Manhattan distance with incomplete covariates</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>simu_data</span><span class='op'>)</span>

<span class='va'>try1</span> <span class='op'>=</span> <span class='fu'><a href='transfo_dist.html'>transfo_dist</a></span><span class='op'>(</span><span class='va'>simu_data</span>,quanti <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>8</span><span class='op'>)</span>, nominal <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>4</span><span class='op'>:</span><span class='fl'>5</span>,<span class='fl'>7</span><span class='op'>)</span>,
                    ordinal <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>6</span><span class='op'>)</span>, logic <span class='op'>=</span> <span class='cn'>NULL</span>, prep_choice <span class='op'>=</span> <span class='st'>"M"</span><span class='op'>)</span>
</div><div class='co'>#&gt; Your target DB[, "Z"] was numeric ... By default, it has been converted in factor of integers</div><div class='co'>#&gt; 5 remaining levels</div><div class='input'><span class='va'>res1</span> <span class='op'>=</span> <span class='fu'><a href='proxim_dist.html'>proxim_dist</a></span><span class='op'>(</span><span class='va'>try1</span>,norm <span class='op'>=</span> <span class='st'>"M"</span><span class='op'>)</span>


<span class='co'>### Y and Z are a same variable encoded in 2 different forms:</span>
<span class='co'>### (3 levels for Y and 5 levels for Z)</span>
<span class='co'>### ... Stored in two distinct databases, A and B, respectively</span>
<span class='co'>### The marginal distribution of Y in B is unknown,</span>
<span class='co'>### as the marginal distribution of Z in A ...</span>

<span class='co'># By supposing that the following matrix called transport symbolizes</span>
<span class='co'># an estimation of the joint distribution L(Y,Z) ...</span>
<span class='co'># Note that, in reality this distribution is UNKNOWN and is</span>
<span class='co'># estimated in the OT function by resolving an optimisation problem.</span>

<span class='va'>transport1</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>0.35285714</span>,<span class='fl'>0</span>,<span class='fl'>0.09142857</span>,<span class='fl'>0</span>,<span class='fl'>0.03571429</span>,
                      <span class='fl'>0</span>,<span class='fl'>0</span>,<span class='fl'>0.08285714</span>,<span class='fl'>0</span>,<span class='fl'>0.07857143</span>,<span class='fl'>0.03142857</span>,
                      <span class='fl'>0.32714286</span>,<span class='fl'>0</span>,<span class='fl'>0</span><span class='op'>)</span>,ncol <span class='op'>=</span> <span class='fl'>5</span>,byrow <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>


<span class='co'># The predicted values of Y in database B and Z in</span>
<span class='co'># database A are stored in the following object:</span>

<span class='va'>res2</span> <span class='op'>=</span> <span class='fu'>indiv_grp_optimal</span><span class='op'>(</span><span class='va'>res1</span>,jointprobaA <span class='op'>=</span> <span class='va'>transport1</span>,
                         jointprobaB <span class='op'>=</span> <span class='va'>transport1</span>,
                         percent_closest<span class='op'>=</span> <span class='fl'>0.90</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>res2</span><span class='op'>)</span>
</div><div class='co'>#&gt;         Length Class  Mode   
#&gt; YAtrans 400    -none- numeric
#&gt; ZBtrans 300    -none- numeric</div><div class='input'><span class='co'># }</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Gregory Guernec, Valerie Gares.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


