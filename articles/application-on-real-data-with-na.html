<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>application-on-real-data-with-na • OTrecod</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="application-on-real-data-with-na">
<meta property="og:description" content="OTrecod">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">OTrecod</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/an-application-of-the-OTrecod-package.html">an-application-of-the-OTrecod-package</a>
    </li>
    <li>
      <a href="../articles/application-on-real-data-with-na.html">application-on-real-data-with-na</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="application-on-real-data-with-na_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>application-on-real-data-with-na</h1>
            
      
      
      <div class="hidden name"><code>application-on-real-data-with-na.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="the-ncds-project">The NCDS project<a class="anchor" aria-label="anchor" href="#the-ncds-project"></a>
</h3>
<p> </p>
<p align="justify">
The National Child Development Study project also called NCDS project (<a href="https://cls.ucl.ac.uk/cls-studies/1958-national-child-development-study/" class="external-link uri">https://cls.ucl.ac.uk/cls-studies/1958-national-child-development-study/</a>) is a continuing survey which follows the lives of over 17,000 people born in England, Scotland and Wales in a same week of the year 1958.
</p>
<p align="justify">
The project is well-known today because its results have greatly contributed to improve the quality of maternity services in UK.
</p>
<p align="justify">
This survey collects specific information on many distinct fields like physical and educational development, economic circumstances, employment, family life, health behaviour, well-being, social participation and attitudes.
</p>
<p> </p>
</div>
<div class="section level3">
<h3 id="the-problem">The problem<a class="anchor" aria-label="anchor" href="#the-problem"></a>
</h3>
<p> </p>
<p align="justify">
Two possible measurements scales of the social class of the participants built from profession can have been collected at each updates of data collection.
</p>
<p align="justify">
The first one corresponds to the <strong>Goldthorp Social Class 90</strong> scale (<strong>GO90</strong>), a scale with 12 categories, while the second one corresponds to the <strong>RG Social Class 91</strong> scale (<strong>RG91</strong>), a scale with only 7 categories respectively described in the documentation of the <em>ncds_14</em> and <em>ncds_5</em> databases.
</p>
<p align="justify">
If during the first survey waves, the information related to the social level of each participant is collected using the <strong>GO90</strong> scale, it is the <strong>RG91</strong> scale that was used exclusively from wave 5. This variation in data collection could pose a problem related to the exploitation of this variable, when including new participants in cohort studies, especially because there is actually no overlaps bethween the two databases.
</p>
<p><strong>Question: how to work with the greatest number of participants encountered in the study without losing the information related to the individual social level?</strong></p>
<p>Answer: We will see in this vignette how the use of the *OTrecod** functions can provide a concrete answer to this question.</p>
<p> </p>
</div>
<div class="section level3">
<h3 id="the-solution">The solution<a class="anchor" aria-label="anchor" href="#the-solution"></a>
</h3>
<p> </p>
<p align="justify">
Functions from the <strong>OTrecod</strong> package can help users to solve the problem introduced in the previous section by recoding the missing scale <strong>GO90</strong> or/and <strong>RG91</strong> in the corresponding databases as described in the following paragraphs dedicated to the imputation of <strong>GO90</strong> in <em>ncds_5</em>. However, it would be obvioulsy possible to impute <strong>RG91</strong> in <em>ncds_14</em> or both in a similar process.
</p>
<p> </p>
</div>
<div class="section level3">
<h3 id="package-installation">Package installation<a class="anchor" aria-label="anchor" href="#package-installation"></a>
</h3>
<p> </p>
<p>If the package <strong>OTrecod</strong> is not installed in their current R versions, users can install it by following the standard instruction:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"OTrecod"</span><span class="op">)</span></span></code></pre></div>
<p>Each time an R session is opened, the <strong>OTrecod</strong> library must be loaded with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">OTrecod</span><span class="op">)</span></span></code></pre></div>
<p>Moreover, the development version of <strong>OTrecod</strong> can be installed actually from <a href="https://github.com/otrecoding/OTrecod" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install development version from GitHub</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"otrecoding/OTrecod"</span><span class="op">)</span></span></code></pre></div>
<p> </p>
</div>
<div class="section level3">
<h3 id="databases-installation">databases installation<a class="anchor" aria-label="anchor" href="#databases-installation"></a>
</h3>
<p> </p>
<p align="justify">
Participants from waves 1 to 4 were stored in a database called <em>ncds_14</em> provided in the <strong>OTrecod</strong> package. In the same way, informations related to new participants included in the study from the wave 5 were stored in the <em>ncds_5</em> database. These two base are available in <strong>OTrecod</strong> and can be simply loaded as follows:
</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load("C:\\Users\\secr\\Desktop\\newpack\\datas_vignet2.RData")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ncds_14</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ncds_5</span><span class="op">)</span></span></code></pre></div>
<p>Here is the description of all the variables contained in each of the databases:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ncds_14</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ncds_5</span><span class="op">)</span></span>
<span><span class="co">#&gt;     ncdsid               GO90      health         employ      gender    </span></span>
<span><span class="co">#&gt;  Length:5476        20     :876   1   :1596   1      :1436   1   :2262  </span></span>
<span><span class="co">#&gt;  Class :character   71     :840   2   :2429   7      :1250   2   :2408  </span></span>
<span><span class="co">#&gt;  Mode  :character   10     :766   3   : 516   4      : 777   NA's: 806  </span></span>
<span><span class="co">#&gt;                     31     :727   4   :  72   3      : 431              </span></span>
<span><span class="co">#&gt;                     60     :509   NA's: 863   6      :  89              </span></span>
<span><span class="co">#&gt;                     (Other):952               (Other):  68              </span></span>
<span><span class="co">#&gt;                     NA's   :806               NA's   :1425              </span></span>
<span><span class="co">#&gt;   study     </span></span>
<span><span class="co">#&gt;  1   :3006  </span></span>
<span><span class="co">#&gt;  2   :1664  </span></span>
<span><span class="co">#&gt;  NA's: 806  </span></span>
<span><span class="co">#&gt;             </span></span>
<span><span class="co">#&gt;             </span></span>
<span><span class="co">#&gt;             </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ncdsid          gender  RG91     health        employ    study  </span></span>
<span><span class="co">#&gt;  Length:365         1:178   0 : 8   1   :121   1      :102   1:231  </span></span>
<span><span class="co">#&gt;  Class :character   2:187   10:18   2   :195   7      : 87   2:134  </span></span>
<span><span class="co">#&gt;  Mode  :character           20:95   3   : 41   4      : 76          </span></span>
<span><span class="co">#&gt;                             31:88   4   :  6   3      : 32          </span></span>
<span><span class="co">#&gt;                             32:74   NA's:  2   6      :  7          </span></span>
<span><span class="co">#&gt;                             40:68              (Other):  3          </span></span>
<span><span class="co">#&gt;                             50:14              NA's   : 58</span></span></code></pre></div>
<p>From these descriptive statistics, we can make the following remarks:</p>
<ol style="list-style-type: decimal">
<li>Each of the files contains only one scale measuring the social class of the participants: the <em>ncds_14</em> database measures the social class from the <strong>G090</strong> scale only, which currently makes it impossible to study this variable on all the waves of data collection carried out.</li>
<li>The other variables seem at first sight labeled and coded in a similar way from one dataset to another.</li>
<li>Some variables have incomplete informations (including social class scales in <em>ncds_14</em>) and the missingness structures seems independant from the databases.</li>
<li>There are only a few variables contained in the two databases.</li>
<li>Same labels predictors are not sorted in the same order from one database to another.</li>
</ol>
<p> </p>
</div>
<div class="section level3">
<h3 id="handling-missing-information">Handling missing information<a class="anchor" aria-label="anchor" href="#handling-missing-information"></a>
</h3>
<p> </p>
<p align="justify">
Firsly, <strong>JOINT</strong> algorithms from the <strong>OT_joint</strong> function of the package requires complete predictors to run, which is not the case for <strong>OUTCOME</strong> algorithms implemented in the <strong>OT_outcome</strong> function. Keeping this information in mind, we know that for a comparison of these two families of algorithm, it will be necessary to work either with complete cases predictors or to carry out a preliminary imputation on them before the data fusion.
</p>
<p>The <strong>merge_dbs</strong> function can solve problems 2 and 3 introduced in the previous paragraph:</p>
<ul>
<li>by removing from the upcoming data fusion, participants whose social class informations are missing from their databases (corresponding to 806 participants in <em>ncds_14</em>).</li>
<li>by detecting and excluding predictors, labeled and/or coded differently from one database to another.</li>
<li>possibly imputing incomplete predictors using MICE or FAMD procedures (see the documentation of <strong>imput_cov</strong> for mored details about the methods).</li>
<li>finally, by superimposing the two datasets by only keeping the shared predictors.</li>
</ul>
<p align="justify">
Here is the R code related to a MICE imputation (with only 2 replications for running time reasons of the vignette). Using the MICE procedure directly integrated in <strong>merge_dbs</strong> supposes that the user accepts the hypothesis that all predictors will participate to the imputation.
</p>
<p align="justify">
In situation where this hypothesis does not hold but imputation still appear as necessary, the imputation of missing values will have to be done through another function (not provided by the package).
</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merged_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_dbs.html">merge_dbs</a></span><span class="op">(</span><span class="va">ncds_14</span>, <span class="va">ncds_5</span>,</span>
<span>                        row_ID1 <span class="op">=</span> <span class="fl">1</span>, row_ID2 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                        NAME_Y <span class="op">=</span> <span class="st">"GO90"</span>, NAME_Z <span class="op">=</span> <span class="st">"RG91"</span>,</span>
<span>                        ordinal_DB1 <span class="op">=</span> <span class="fl">3</span>, ordinal_DB2 <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                        impute <span class="op">=</span> <span class="st">"MICE"</span>, R_MICE <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                        seed_choice <span class="op">=</span> <span class="fl">3023</span><span class="op">)</span></span>
<span><span class="co">#&gt; DBS MERGING in progress. Please wait ...</span></span>
<span><span class="co">#&gt; DBS MERGING OK</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SUMMARY OF DBS MERGING:</span></span>
<span><span class="co">#&gt; Nb of removed subjects due to NA on targets: 806(14%)</span></span>
<span><span class="co">#&gt; Nb of removed covariates due to differences between the 2 bases: 0</span></span>
<span><span class="co">#&gt; Nb of remained covariates: 4</span></span>
<span><span class="co">#&gt; Imputation on incomplete covariates: MICE</span></span></code></pre></div>
<p>Process details indicate here that 806 participants have been deleted from the data fusion because of missing information on <strong>GO90</strong> in the <em>ncds_14</em> database.</p>
<p align="justify">
By definition, <strong>GO90</strong> in <em>ncds_14</em> and <strong>RG91</strong> in <em>ncds_5</em> does not seem to correspond clearly to ordered scales and can be considered as simple factors. This is the case here, because the only variable defined as an ordered factor in the study is the <em>health</em> variable. This variable correspond to the third column of <em>ncds_14</em> and to the fourth column of <em>ncds_5</em>. A seed value is arbitrarily fixed to 3023 here to guarantee the reproductibility of the results in the vignette.
</p>
<p>In the output list, The <em>DB_READY</em> object provides the overlayed database with the shared predictors imputed as described by:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">merged_tab</span><span class="op">$</span><span class="va">DB_READY</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">merged_tab</span><span class="op">$</span><span class="va">DB_READY</span><span class="op">)</span></span>
<span><span class="co">#&gt;      DB  Y    Z employ gender health study</span></span>
<span><span class="co">#&gt; 5708  1 20 &lt;NA&gt;      3      1      1     1</span></span>
<span><span class="co">#&gt; 5709  1 71 &lt;NA&gt;      1      1      2     1</span></span>
<span><span class="co">#&gt; 5710  1 32 &lt;NA&gt;      1      2      1     1</span></span>
<span><span class="co">#&gt; 5711  1 60 &lt;NA&gt;      7      1      1     1</span></span>
<span><span class="co">#&gt; 5712  1 31 &lt;NA&gt;      7      2      2     1</span></span>
<span><span class="co">#&gt; 5714  1 31 &lt;NA&gt;      1      1      3     1</span></span>
<span><span class="co">#&gt; [1] 5035    7</span></span></code></pre></div>
<p>All predictors same labels were finally kept: their coding being visibly in adequacy from one dataset to another.</p>
<p> </p>
</div>
<div class="section level3">
<h3 id="matching-predictors-evaluation">Matching predictors evaluation<a class="anchor" aria-label="anchor" href="#matching-predictors-evaluation"></a>
</h3>
<p> </p>
<p align="justify">
Here, the limited number of predictors at the beginning of the study makes it unnecessary to use a selection procedure like random forest, nevertheless the <strong>select_pred</strong> function can provide users interesting information about the association of predictors, their ability to fit the target scales in each dataset, and their risks of collinearities, especially if it is necessary to further reduce the set of sharing predictors before recoding scales.
</p>
<p align="justify">
Keeping too many predictors for the fusion does not improve its quality and greatly increases the resolution time of the algorithms, that is why, as an advice, keeping only 3 predictors for each fusion seems to be a good compromise between computation time and efficiency.
</p>
<p>Let’s use the results of the <strong>select_pred</strong> function to only keep 3 predictors for data fusion (instead of the four currently present).</p>
<p>Here is the related R code taking the database obtained after executing <strong>merge_dbs</strong> as argument, and the variables <strong>GO90</strong> and <strong>RG91</strong> as respective outcomes in the two datasets:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ncds_14</span></span>
<span><span class="va">sel_pred_GO90</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_pred.html">select_pred</a></span><span class="op">(</span><span class="va">merged_tab</span><span class="op">$</span><span class="va">DB_READY</span>,</span>
<span>                             Y <span class="op">=</span> <span class="st">"Y"</span>, Z <span class="op">=</span> <span class="st">"Z"</span>,</span>
<span>                             ID <span class="op">=</span> <span class="fl">1</span> , OUT <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>                             nominal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">7</span><span class="op">)</span>, ordinal <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                             RF <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; The select_pred function is running for outcome= Y. Please wait ...</span></span>
<span><span class="co">#&gt; The process is now successfully completed</span></span>
<span><span class="co">#&gt; ---------</span></span>
<span><span class="co">#&gt; For comparison with another outcome from two overlayed tables  : </span></span>
<span><span class="co">#&gt; just adapt the OUT option keeping all the others unchanged in the function</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; For comparison with another outcome from two unoverlayed tables:</span></span>
<span><span class="co">#&gt; just adapt the arguments from Y to convert_class</span></span>
<span><span class="co">#&gt; ---------</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ncds_5</span></span>
<span><span class="va">sel_pred_RG91</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_pred.html">select_pred</a></span><span class="op">(</span><span class="va">merged_tab</span><span class="op">$</span><span class="va">DB_READY</span>, Y <span class="op">=</span> <span class="st">"Y"</span>, Z <span class="op">=</span> <span class="st">"Z"</span>,</span>
<span>                             ID <span class="op">=</span> <span class="fl">1</span>, OUT <span class="op">=</span> <span class="st">"Z"</span>,</span>
<span>                             nominal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">7</span><span class="op">)</span>, ordinal <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                             RF <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; The select_pred function is running for outcome= Z. Please wait ...</span></span>
<span><span class="co">#&gt; The process is now successfully completed</span></span>
<span><span class="co">#&gt; ---------</span></span>
<span><span class="co">#&gt; For comparison with another outcome from two overlayed tables  : </span></span>
<span><span class="co">#&gt; just adapt the OUT option keeping all the others unchanged in the function</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; For comparison with another outcome from two unoverlayed tables:</span></span>
<span><span class="co">#&gt; just adapt the arguments from Y to convert_class</span></span>
<span><span class="co">#&gt; ---------</span></span></code></pre></div>
<p>Automatic exits inform the user about the state of the process and assist him in the implementation of the function.</p>
<p align="justify">
We first study the existence of potential collinearity between the predictors. At the acceptability thresholds set by default as input to the <strong>merge_dbs</strong> function, and in particular, the one associated with the V-Cramer criterion, we detect collinearity in the two bases, between the variables <em>employ</em> and <em>gender</em>, as described below:
</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ncds_14</span></span>
<span><span class="va">sel_pred_GO90</span><span class="op">$</span><span class="va">collinear_PB</span><span class="op">$</span><span class="va">VCRAM</span></span>
<span><span class="co">#&gt;     name1  name2 V_Cramer CorrV_Cramer    N</span></span>
<span><span class="co">#&gt; 21 employ gender   0.4831       0.4819 4670</span></span>
<span></span>
<span><span class="co">## ncds_5</span></span>
<span><span class="va">sel_pred_RG91</span><span class="op">$</span><span class="va">collinear_PB</span><span class="op">$</span><span class="va">VCRAM</span></span>
<span><span class="co">#&gt;     name1  name2 V_Cramer CorrV_Cramer   N</span></span>
<span><span class="co">#&gt; 21 employ gender   0.6169       0.6042 365</span></span></code></pre></div>
<p>This result suggests that we should keep only one of these two predictors. But which of the two should we keep? <em>employ</em> or <em>gender</em> ?</p>
<p>To help us decide, we can simply observe the ability of the two variables to predict the target variables in the two databases:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ncds_14</span></span>
<span><span class="va">sel_pred_GO90</span><span class="op">$</span><span class="va">vcrm_OUTC_cat</span></span>
<span><span class="co">#&gt;   name1  name2 V_Cramer CorrV_Cramer    N</span></span>
<span><span class="co">#&gt; 3     Y gender   0.4911       0.4888 4670</span></span>
<span><span class="co">#&gt; 5     Y  study   0.4491       0.4465 4670</span></span>
<span><span class="co">#&gt; 2     Y employ   0.1765       0.1698 4670</span></span>
<span><span class="co">#&gt; 4     Y health   0.1141       0.1033 4670</span></span>
<span></span>
<span><span class="co">## ncds_5</span></span>
<span><span class="va">sel_pred_RG91</span><span class="op">$</span><span class="va">vcrm_OUTC_cat</span></span>
<span><span class="co">#&gt;   name1  name2 V_Cramer CorrV_Cramer   N</span></span>
<span><span class="co">#&gt; 5     Z  study   0.4507       0.4326 365</span></span>
<span><span class="co">#&gt; 3     Z gender   0.4367       0.4180 365</span></span>
<span><span class="co">#&gt; 2     Z employ   0.2070       0.1637 365</span></span>
<span><span class="co">#&gt; 4     Z health   0.1579       0.0923 365</span></span></code></pre></div>
<p>These results present two variables whose ability to predict the target variable is equivalent in the two databases. How do these variables interact with the other predictors?</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## ncds_14</span></span>
<span><span class="va">sel_pred_GO90</span><span class="op">$</span><span class="va">vcrm_X_cat</span></span>
<span><span class="co">#&gt;     name1  name2 V_Cramer CorrV_Cramer    N</span></span>
<span><span class="co">#&gt; 21 employ gender   0.4831       0.4819 4670</span></span>
<span><span class="co">#&gt; 41 employ  study   0.2318       0.2290 4670</span></span>
<span><span class="co">#&gt; 23 health  study   0.1623       0.1603 4670</span></span>
<span><span class="co">#&gt; 31 employ health   0.1167       0.1111 4670</span></span>
<span><span class="co">#&gt; 32 gender  study   0.0720       0.0705 4670</span></span>
<span><span class="co">#&gt; 22 gender health   0.0433       0.0351 4670</span></span>
<span></span>
<span><span class="co">## ncds_5</span></span>
<span><span class="va">sel_pred_RG91</span><span class="op">$</span><span class="va">vcrm_X_cat</span></span>
<span><span class="co">#&gt;     name1  name2 V_Cramer CorrV_Cramer   N</span></span>
<span><span class="co">#&gt; 21 employ gender   0.6169       0.6042 365</span></span>
<span><span class="co">#&gt; 41 employ  study   0.2979       0.2692 365</span></span>
<span><span class="co">#&gt; 31 employ health   0.2676       0.2358 365</span></span>
<span><span class="co">#&gt; 23 health  study   0.1873       0.1640 365</span></span>
<span><span class="co">#&gt; 22 gender health   0.0716       0.0000 365</span></span>
<span><span class="co">#&gt; 32 gender  study   0.0017       0.0000 365</span></span></code></pre></div>
<p align="justify">
The stronger association in both datasets of the variable <em>employ</em> with <em>study</em>, compared to that observed with the variable <em>gender</em>, would rather encourage us to keep <em>gender</em> for the data fusion. Even if, it is also true that this selection criterion remains very tenuous here.
</p>
<p>We therefore decide to keep the <em>study</em>, <em>gender</em> and <em>health</em> predictors to solve our recoding problem.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merged_fin</span> <span class="op">=</span> <span class="va">merged_tab</span><span class="op">$</span><span class="va">DB_READY</span><span class="op">[</span>, <span class="op">-</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">merged_fin</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;      DB  Y    Z gender health study</span></span>
<span><span class="co">#&gt; 5708  1 20 &lt;NA&gt;      1      1     1</span></span>
<span><span class="co">#&gt; 5709  1 71 &lt;NA&gt;      1      2     1</span></span>
<span><span class="co">#&gt; 5710  1 32 &lt;NA&gt;      2      1     1</span></span></code></pre></div>
<p> </p>
</div>
<div class="section level3">
<h3 id="imputation-of-go90-using-optimal-transportation-theory">Imputation of GO90 using optimal transportation theory<a class="anchor" aria-label="anchor" href="#imputation-of-go90-using-optimal-transportation-theory"></a>
</h3>
<p align="justify">
The imputation of <strong>GO90</strong> in the <em>ncds_5</em> can be the result of two family of algorithms in <strong>OTrecod</strong>: <strong>OUTCOME</strong> or <strong>JOINT</strong>. Both of them used optimal transportation theory and can be eventually improved by relaxing the distributional assumptions.
</p>
<p><strong>OUTCOME</strong> algorithms are implemented in the <strong>OT_outcome</strong> function while <strong>JOINT</strong> algorithms are implemented in <strong>OT_JOINT</strong>.</p>
<p>It is suggested to fit and compare several models using the output criteria of the <strong>verif_OT</strong> function, to determine which one provides the better set of <strong>GO90</strong> predictions in <em>ncds_5</em>.</p>
<p>Here is the R commands to fit an <strong>OUTCOME</strong> model and a <strong>JOINT</strong> model with no relaxation and regularization parameter.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outc1</span> <span class="op">=</span> <span class="fu"><a href="../reference/OT_outcome.html">OT_outcome</a></span><span class="op">(</span><span class="va">merged_fin</span>, nominal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, ordinal <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>                   dist.choice <span class="op">=</span> <span class="st">"E"</span>, indiv.method <span class="op">=</span> <span class="st">"sequential"</span>,</span>
<span>                   which.DB <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ---------------------------------------</span></span>
<span><span class="co">#&gt; OT PROCEDURE in progress ...</span></span>
<span><span class="co">#&gt; ---------------------------------------</span></span>
<span><span class="co">#&gt; Type                     = OUTCOME</span></span>
<span><span class="co">#&gt; Distance                 = Euclidean</span></span>
<span><span class="co">#&gt; Percent closest knn      = 100%</span></span>
<span><span class="co">#&gt; Relaxation parameter     = NO</span></span>
<span><span class="co">#&gt; Relaxation value         = 0</span></span>
<span><span class="co">#&gt; Individual pred process  = Sequential</span></span>
<span><span class="co">#&gt; DB imputed               = B</span></span>
<span><span class="co">#&gt; ---------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outj1</span> <span class="op">=</span> <span class="fu"><a href="../reference/OT_joint.html">OT_joint</a></span><span class="op">(</span><span class="va">merged_fin</span>, nominal <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, ordinal <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>                 dist.choice <span class="op">=</span> <span class="st">"E"</span>, which.DB <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ---------------------------------------</span></span>
<span><span class="co">#&gt; OT JOINT PROCEDURE in progress ...</span></span>
<span><span class="co">#&gt; ---------------------------------------</span></span>
<span><span class="co">#&gt; Type                  = JOINT</span></span>
<span><span class="co">#&gt; Distance              = Euclidean</span></span>
<span><span class="co">#&gt; Percent closest       = 100%</span></span>
<span><span class="co">#&gt; Relaxation term       = 0</span></span>
<span><span class="co">#&gt; Regularization term   = 0</span></span>
<span><span class="co">#&gt; Aggregation tol cov   = 0.3</span></span>
<span><span class="co">#&gt; DB imputed            = B</span></span>
<span><span class="co">#&gt; ---------------------------------------</span></span></code></pre></div>
<p> </p>
<p align="justify">
Now let’s see the validity criteria of the two models using the <strong>verif_OT</strong> function. we simply want to retrieve the stability criteria and Cramer’s V which compares the association of the two different (unordered) scales and so complete the arguments according to this choice:
</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">### For the model outc1</span></span>
<span><span class="va">verif_outc1</span>   <span class="op">=</span> <span class="fu"><a href="../reference/verif_OT.html">verif_OT</a></span><span class="op">(</span><span class="va">outc1</span>, ordinal <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                         stab.prob <span class="op">=</span> <span class="cn">TRUE</span>, min.neigb <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### For the model outj1</span></span>
<span><span class="va">verif_outj1</span>   <span class="op">=</span> <span class="fu"><a href="../reference/verif_OT.html">verif_OT</a></span><span class="op">(</span><span class="va">outj1</span>, ordinal <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                         stab.prob <span class="op">=</span> <span class="cn">TRUE</span>, min.neigb <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p align="justify">
Firstly, the estimates of the Hellinger distance for the two models (both upper 0.05) confirm that the two scales could respectively share the same distribution in the two databases. Consequently, there is no need here to add relaxation parameters in the models to have acceptable predictions of <strong>GO90</strong> in <em>ncds_5</em>.
</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">### For the model outc1: Hellinger distance</span></span>
<span><span class="va">verif_outc1</span><span class="op">$</span><span class="va">hell</span></span>
<span><span class="co">#&gt;                 YA_YB ZA_ZB</span></span>
<span><span class="co">#&gt; Hellinger dist. 0.085    NA</span></span>
<span></span>
<span><span class="co">### For the model outj1: Hellinger distance</span></span>
<span><span class="va">verif_outj1</span><span class="op">$</span><span class="va">hell</span></span>
<span><span class="co">#&gt;                 YA_YB ZA_ZB</span></span>
<span><span class="co">#&gt; Hellinger dist. 0.209    NA</span></span></code></pre></div>
<p align="justify">
The V Cramer criterion informs about the strength of the association between the two scales. Even if they have specific encodings, <strong>GO90</strong> and <strong>RG91</strong> summarize a same information: the social class of the participant. Therefore, we can reasonably think that the stronger will be the association, the more reliable will be the predictions.
</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">### For the model outc1: Hellinger distance</span></span>
<span><span class="va">verif_outc1</span><span class="op">$</span><span class="va">res.prox</span></span>
<span><span class="co">#&gt;        N   V_cram rank_cor </span></span>
<span><span class="co">#&gt;  365.000    0.640    0.736</span></span>
<span></span>
<span><span class="co">### For the model outj1: Hellinger distance</span></span>
<span><span class="va">verif_outj1</span><span class="op">$</span><span class="va">res.prox</span></span>
<span><span class="co">#&gt;        N   V_cram rank_cor </span></span>
<span><span class="co">#&gt;  365.000    0.740    0.894</span></span></code></pre></div>
<p>The large number of modalities of <strong>GO90</strong> explains the relative stability observed for the predictions:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">### For the model outc1: Hellinger distance</span></span>
<span><span class="va">verif_outc1</span><span class="op">$</span><span class="va">res.stab</span></span>
<span><span class="co">#&gt;          N min.N mean    sd</span></span>
<span><span class="co">#&gt; 2nd DB 270     5 0.77 0.288</span></span>
<span></span>
<span><span class="co">### For the model outj1: Hellinger distance</span></span>
<span><span class="va">verif_outj1</span><span class="op">$</span><span class="va">res.stab</span></span>
<span><span class="co">#&gt;          N min.N  mean    sd</span></span>
<span><span class="co">#&gt; 2nd DB 270     5 0.644 0.152</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h3>
<p align="justify">
The two models provide acceptable predictions of <strong>GO90</strong> in <em>ncds_5</em>. Nevertheless, the <strong>JOINT</strong> algorithm is here prefered for the reasons previously exposed (no relaxation and regularization parameters required, better reliability of predictions with this specific database).
</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Gregory Guernec, Valerie Gares.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
